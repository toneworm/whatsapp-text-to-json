var e=require("fs");const s=/(image|audio|video|GIF) omitted$/;function t(e){const s=[8206,8236].map(e=>String.fromCharCode(e));return e.replace(new RegExp(`(${s.join("|")})`,"g"),"").trim()}function r(e){if("["!==e[0])return null;const{groups:{year:s,month:t,date:r,hour:n,min:o,sec:i}}=/(?<year>\d{4})\/(?<month>\d{1,2})\/(?<date>\d{1,2}), (?<hour>\d{2}):(?<min>\d{2}):(?<sec>\d{2})/.exec(e);return new Date(s,t-1,r,n,o,i).toISOString()}function n(e){if(/Messages to this group are now secured with end-to-end encryption./.test(e))return{user:null,messageType:"system",message:"Messages to this group are now secured with end-to-end encryption."};let s=e.indexOf(":");if(s>=0){const t=e.slice(0,s);return{user:t,message:o(e,t),messageType:"message"}}if(s=e.search(/\s(left)/),s>=0)return{user:null,message:e,messageType:"system"};if(s=e.search(/created|added|changed|joined|left|removed|group/),s>=0){const t=e.slice(0,s);return{user:"You"===t?"You":t,message:e,messageType:"action"}}return{user:null,message:e,messageType:null}}function o(e,s=""){return e.slice(s.length+2)}const i=process.argv[2],a=process.argv.slice(2),c=a.includes("-m"),u=a.includes("-t");if(!i)throw Error("No filename provided.");let d,g=i.slice(0,-4)+"-messages.json";try{d=function(e,o,i){const a=e.split("\n"),c=[];for(let e=0,u=a.length;e<u;e++){const u=t(a[e]);if(!u.length||!o&&s.test(u)||0===e&&u.indexOf("Messages to this group are now secured with end-to-end encryption.")>=0)continue;const d=r(u.slice(0,22));if(d){const{user:e,messageType:s,message:t}=n(u.slice(23));c.push({date:d,user:e,message:t,...i?{type:s}:{}})}else c[c.length-1].message+="\n"+u}return{data:c}}(e.readFileSync(i,"utf8"),c,u)}catch(e){throw Error("Error loading file. Make sure the filename is correct and target file exists.")}if(!d)throw Error("No data returned.");e.writeFile(g,JSON.stringify(d),e=>{if(e)throw e;console.log("written to "+g+"...")});
//# sourceMappingURL=chat-to-messages.js.map
